/// Outputs background image properties for icons in the different button states
/// for the set theme.
///
/// @param {String} $icon-name, any icon name found in o-ft-icons
/// @param {String} $theme, any theme name (primary, secondary, etc). Custom themes not supported.
@mixin _oButtonsIconsForTheme($theme, $icons) {
	// Output icons for theme.
	@each $icon-name in $icons {
		// Get theme selector for built in theme.
		$theme-selector: map-get($_o-buttons-themes, $theme);
		@if type-of($theme) == 'string' and $theme-selector == null {
			@error 'Button theme "#{$theme}" does not exist. Must be one of "#{map-keys($_o-buttons-themes)}".';
		}

		#{$theme-selector}.o-buttons-icon.o-buttons-icon--#{$icon-name} {
			@include _oButtonsGetIconForThemeAndState($icon-name, $theme, 'normal');
			// Add fallback for MS High Contrast mode.
			// This only needs to be output once, not for every button state.
			// sass-lint:disable no-vendor-prefixes
			@media screen and (-ms-high-contrast: active) {
				@include oIconsGetIcon($icon-name: $icon-name, $apply-base-styles: false, $apply-width-height: false, $color: #ffffff, $iconset-version: 1, $high-contrast-fallback: false);
			}
			@media screen and (-ms-high-contrast: black-on-white) {
				@include oIconsGetIcon($icon-name: $icon-name, $apply-base-styles: false, $apply-width-height: false, $color: #000000, $iconset-version: 1, $high-contrast-fallback: false);
			}
			// sass-lint:enable no-vendor-prefixes

			// https://www.w3.org/TR/wai-aria-1.1/#aria-selected
			// https://www.w3.org/TR/wai-aria-1.1/#aria-pressed
			&[aria-selected=true], // e.g. A selected tab or page number in pagination.
			&[aria-current], // e.g. A selected tab or page number in pagination (for links only).
			&[aria-pressed=true], // e.g. A "follow" button that is pressed.
			&:active {
				@include _oButtonsGetIconForThemeAndState($icon-name, $theme, 'active');
			}

			&:not([disabled]) {
				&:hover {
					@include _oButtonsGetIconForThemeAndState($icon-name, $theme, 'hover');
				}
				&:focus {
					@include _oButtonsGetIconForThemeAndState($icon-name, $theme, 'focus');
				}
			}

			// Hack to get the active state colour svg to download to prevent FOIC
			&:after {
				@include _oButtonsGetIconForThemeAndState($icon-name, $theme, 'active');
				content: '';
			}
		}
	}
}

/// Request an icon from o-icons with color based on the o-buttons theme and state
///
/// @param {String} $icon-name, icon to request
/// @param {String|Map} $theme, one of $o-colors-theme or a custom theme map
/// @param {String} $state - One of normal, hover, focus, selected, disabled, pressed
@mixin _oButtonsGetIconForThemeAndState($icon-name, $theme, $state) {
	// 1. Get the icon color for the button state and theme.
	$icon-color: oButtonsGetColor($state, 'color', $theme);

	// 2. If the icon color is not a color assume it is in the palette.
	@if $icon-color and type-of($icon-color) != 'color' {
		$icon-color: oColorsGetPaletteColor($icon-color);
	}

	// 3. Output the icon.
	@include oIconsGetIcon($icon-name: $icon-name, $apply-base-styles: false, $apply-width-height: false, $color: $icon-color, $iconset-version: 1, $high-contrast-fallback: false);
}
